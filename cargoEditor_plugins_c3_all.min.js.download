CargoEditor.addPlugin("cargoGlyphFix",function(e){"use strict";function i(e,t){e.classList.contains(t)||e.classList.add(t)}function l(e,t){e.classList.contains(t)&&(e.classList.remove(t),0===e.classList.length)&&e.attributes.removeNamedItem("class")}var t=_.throttle(function(e){[].forEach.call(e.getElement().querySelectorAll("a"),_.bind(function(e){var t=!1,n=!1;if(/^[\s]+$/gi.test(e.textContent)||0===e.textContent.length){for(var o=!1,a=0;a<e.children.length;a++)"IMG"!==e.children[a].nodeName&&"MEDIA-ITEM"!==e.children[a].nodeName||(o=!0),"TEXT-ICON"===e.children[a].nodeName&&(t=!0);o?(i(e,"image-link"),n=!0):t&&i(e,"icon-link")}t||l(e,"icon-link"),n||l(e,"image-link")},this))},100);e.getEditorInstances().forEach(_.bind(t,this)),this.events.on("editor-instanciated",_.bind(t,this)),this.events.on("editor-summary-created",_.bind(t,this)),this.events.on("glyph-plugin-check-links",_.bind(t,this))}),CargoEditor.addPlugin("implementationFixes",function(h){"use strict";function n(){[].forEach.call(o,function(e){e.setAttribute("contenteditable","false")}),o=[]}var o=[],l=(this.events.on("editor-dragin",function(e,t){e=e.getElement(),n(),o=e.querySelectorAll('[contenteditable="false"]'),[].forEach.call(o,function(e){e.setAttribute("contenteditable","true")})}),this.events.on("editor-drop",function(e,t){n()}),this.events.on("editor-dragout",function(e,t){n()}),this.events.on("editor-dragend",function(e,t){n()}),this.events.on("editor-destroyed",function(e,t){n()}),this.events.on("editor-keypress",function(e){var n,t="number"==typeof event.which?event.which:event.keyCode;" "===String.fromCharCode(t)&&(n=h.getActiveRange())&&n.collapsed&&this.events.once("mutation-before-success",function(e){var t=h.getActiveRange();n.equals(t)&&t.startOffset===t.endOffset&&n.commonAncestorContainer.nodeType===Node.TEXT_NODE&&0<n.endOffset&&32===n.commonAncestorContainer.data.charCodeAt(n.endOffset)&&(n.commonAncestorContainer.replaceData(t.startOffset,1," "),n.commonAncestorContainer.data.length>=t.startOffset+1)&&(n.setStart(t.startContainer,t.startOffset+1),n.setEnd(t.endContainer,t.endOffset+1),h.helpers.setActiveRange(n))})},this),!1),r=!1,s=(this.events.on("exec-command",function(e,t){r=[t,arguments[2],arguments[3]],l=!0}),["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr","meter","progress","input","video","text-icon","digital-clock"]);this.events.on("mutation-before-success",function(a,d={}){function c(e,t,n){return t>e.length-1?e:e.substring(0,t)+n+e.substring(t+1)}var e=a.generateUnreportedMutationSummaries(),t=h.getActiveRange(),i=!1;if(_.each(e,function(r){var s=[],e=[];e=(e=e.concat(r.characterDataChanged)).concat(r.added),[].forEach.call(e,function(e){if(e.nodeType===Node.TEXT_NODE&&!s.includes(e)){var t,n=0,o=0;for(e.previousSibling&&e.previousSibling.nodeType===Node.TEXT_NODE&&(t=/[ \xa0]+$/.exec(e.previousSibling.data))&&(e=e.previousSibling,o=t.index);e&&e.nodeType===Node.TEXT_NODE;){if(!1===h.helpers.whiteSpaceHelpers.is_all_ws(e)||!0!==d.preventInsertingNonBreakingSpacesInWhitespace&&r.characterDataChanged&&r.characterDataChanged.includes(e)){for(var a=null,i=o;i<e.data.length;i++){0!==i||e.previousSibling&&e.previousSibling.nodeType===Node.TEXT_NODE&&!h.helpers.whiteSpaceHelpers.is_all_ws(e.previousSibling)||window.getComputedStyle(e.parentNode).display.includes("inline")||e.previousElementSibling&&"BR"!==e.previousElementSibling.nodeName&&window.getComputedStyle(e.previousElementSibling).display.includes("inline")||n++;var o=0,l=e.data.charCodeAt(i);9!==l&&10!==l&&13!==l&&(32===l||160===l?(n%2!=0||i===e.data.length-1&&!(e.nextSibling&&e.nextSibling.nodeType===Node.TEXT_NODE&&!h.helpers.whiteSpaceHelpers.is_all_ws(e.nextSibling)||window.getComputedStyle(e.parentNode).display.includes("inline")||e.nextElementSibling&&"BR"!==e.nextElementSibling.nodeName&&window.getComputedStyle(e.nextElementSibling).display.includes("inline"))?160!==l&&(a=c(a||e.data,i," ")):32!==l&&(a=c(a||e.data,i," ")),n++):n=0)}a&&(e.data=a)}s.push(e),e=e.nextSibling}}})}),h.helpers.setActiveRange(t),a.getExecutionDepth()<=1){if(_.each(e,function(e){var t,n,o=[];[].forEach.call(e.added,function(n){null===n.nodeName.match(/^H[1-7]$/g)&&"SMALL"!==n.nodeName||(0===n.children.length&&h.helpers.whiteSpaceHelpers.is_all_ws(n)?n.parentNode&&n.parentNode.removeChild(n):r&&("SMALL"===n.nodeName&&"small"===r[0]?(h.helpers.getAllParents(n,function(e){var t;if(e.nodeName.match(/^H[1-7]$/g))return(t=h.helpers.splitNodeTree(n.parentNode,h.helpers.getIndexInParent(n)+1,e)).nodeType!==Node.ELEMENT_NODE||h.helpers.isEmptyNode(t)||e.parentNode.insertBefore(t,e.nextSibling),(t=h.helpers.splitNodeTree(n.parentNode,h.helpers.getIndexInParent(n),e)).nodeType!==Node.ELEMENT_NODE||h.helpers.isEmptyNode(t)||e.parentNode.insertBefore(t,e.nextSibling),h.helpers.isEmptyNode(e)&&h.helpers.unwrap(e,!0),h.helpers.unwrap(t,!0),!1},a.getElement()),o.push(n)):null!==n.nodeName.match(/^H[1-7]$/g)&&"string"==typeof r[2]&&null!==r[2].match(/^h[1-7]$/g)?_.each(n.querySelectorAll("small"),function(e){h.helpers.unwrap(e,!0)}):"SMALL"===n.nodeName&&"string"==typeof r[2]&&null!==r[2].match(/^h[1-7]$/g)&&h.helpers.getAllParents(n,function(e){if(e.nodeName.match(/^H[1-7]$/g))return h.helpers.unwrap(n,!0),!1},a.getElement())))}),0<o.length&&(e=o[0].childNodes[0],t=(t=o[o.length-1]).childNodes[t.childNodes.length-1],(n=h.rangy.createRange()).setStartBefore(e),n.setEndAfter(t),h.helpers.setActiveRange(n))}),!l&&!d.runImplementationFixesPlugin)return;e=a.generateUnreportedMutationSummaries(),h.getActiveRange();r=l=!1,_.each(e,function(e){var t,n,o;[].forEach.call(e.added,function(e){var t,n,o=h.getActiveRange();if("A"===e.nodeName&&!0!==e.__reparented__){if(1===e.children.length&&e.textContent===e.children[0].textContent&&-1===s.indexOf(e.children[0].nodeName.toLowerCase())){for(t=e.children[0];1===t.children.length&&t.textContent===t.children[0].textContent;){if(-1!==s.indexOf(t.children[0].nodeName.toLowerCase())){n=t.children[0];break}t=t.children[0]}if("OL"!==t.nodeName&&"UL"!==t.nodeName){for(h.helpers.unwrap(e,!1);0<t.childNodes.length;)e.appendChild(t.childNodes[0]);t.appendChild(e),n?o.selectNode(n):o.commonAncestorContainer===e&&o.selectNodeContents(e),h.helpers.setActiveRange(o)}}}else"IFRAME"===e.nodeName&&(i=!0);delete e.__reparented__}),e.projection.childListChangeMap&&[].forEach.call(e.projection.childListChangeMap.keys(),function(e){if(null!==e.parentNode&&"OL"!==e.nodeName&&"UL"!==e.nodeName&&(e.nodeType!==Node.ELEMENT_NODE||!e.hasAttribute("grid-col"))){for(o=e.querySelectorAll("br"),t=0<o.length,n=e;1===e.childElementCount&&"BR"!==e.children[0].nodeName;)e=e.children[0];if(0===e.childNodes.length?t=!1:[].forEach.call(e.childNodes,function(e){!0===t&&(e.nodeType===Node.TEXT_NODE&&!1===h.helpers.isWhitespaceNode(e)||e.nodeType===Node.ELEMENT_NODE&&"BR"!==e.nodeName)&&(t=!1)}),t&&!1===h.helpers.isEditingHost(n)&&0<o.length)if("LI"===n.nodeName){if(null!==n.previousElementSibling&&"LI"===n.previousElementSibling.nodeName){for(;0<n.childNodes.length;)n.previousElementSibling.appendChild(n.firstChild);n.parentNode.removeChild(n)}}else h.helpers.unwrap(n,!0)}})})}i&&"object"==typeof Cargo&&void 0!==Cargo.Plugins&&void 0!==Cargo.Plugins.elementResizer&&(Cargo.Plugins.elementResizer.update(),Cargo.Plugins.elementResizer.refresh())},this)}),CargoEditor.addPlugin("shadowDom",function(I){"use strict";function e(e){if(c){var t=I.getActiveEditor();if(t){var n=t.getElement(),o=window.getSelection(),o=0<o.rangeCount?o.getRangeAt(0):null,o=I.forcedRange&&(!o||!n.contains(o.commonAncestorContainer));if(e.target==u||o)switch(e.type){case"change":e.stopPropagation(),u.value=" ",n.focus({preventScroll:!0});break;case"copy":case"cut":case"paste":n.contains(e.target)||e.stopPropagation(),n.focus({preventScroll:!0}),I.events.trigger("editor-"+e.type,t,e);break;case"keydown":if(e.metaKey||e.altKey||e.ctrlKey)switch(e.key){case"z":case"Z":case"Escape":return}else switch(e.key){case"Backspace":case"Delete":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Enter":e.preventDefault()}e.stopPropagation(),n.focus({preventScroll:!0}),n.dispatchEvent(new KeyboardEvent("keydown",{key:e.key,keyIdentifier:e.keyIdentifier,keyCode:e.keyCode,metaKey:e.metaKey,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,which:e.which}))}}}}function t(e){}function n(e,t){2!==t.button&&window.addEventListener("pointerup",m)}function o(e,t){"Shift"===t.key&&(U=null)}function a(P,e){var t=null,n=I.getActiveRange();switch(e.key){case"ArrowLeft":t="left";break;case"ArrowUp":t="up";break;case"ArrowDown":t="down";break;case"ArrowRight":t="right";break;default:t=null}if(t&&n){var o,a=n.cloneRange(),i=I.getActiveEditor().getElement(),l=(i.focus({preventScroll:!0}),!1),r=!1,s=0,d="forward",c=("up"!=t&&"left"!=t||(d="backward"),"move"),h=(e.shiftKey?(c="extend",U||(U=n.cloneRange(),K=n.cloneRange(),"forward"===d?(U.collapse(!0),K.collapse(!1)):(U.collapse(!1),K.collapse(!0))),s=U.comparePoint(K.startContainer,K.startOffset)):U=K=null,"character"),g=(e.metaKey?h="left"===t||"right"===t?"lineboundary":"documentboundary":e.altKey?h="word":"down"!==t&&"up"!==t||(h="line"),e.preventDefault(),I.helpers.normalizeRangeAroundShadowDom(n));switch(t){case"left":"character"===h&&(o=I.helpers.getAllEffectivelyContainedNodes(n),o=[].filter.call(o,function(t){var e=[].find.call(o,function(e){return e!==t&&e.contains(t)});return!e||!e.shadowRoot}),"extend"===c?0<o.length&&o[0].previousSibling&&o[0].previousSibling===o[0].previousElementSibling&&o[0].shadowRoot&&s<=0?(a.setStartBefore(o[0].previousSibling),(K=a.cloneRange()).collapse(!0),l=!0):0<o.length&&o[o.length-1].previousSibling&&o[o.length-1].previousSibling===o[o.length-1].previousElementSibling&&o[o.length-1].shadowRoot&&1==s?(a.setEndAfter(o[o.length-1].previousSibling),(K=a.cloneRange()).collapse(!1),l=!0):g.shadowDomElementAdjacentToCollapsedRange&&"after"===g.collapseDirection?(a.selectNode(g.shadowDomElementAdjacentToCollapsedRange),(K=a.cloneRange()).collapse(!0),l=!0):g.shadowDomElementAdjacentToCollapsedRange&&"before"===g.collapseDirection&&g.shadowDomElementAdjacentToCollapsedRange.previousSibling&&g.shadowDomElementAdjacentToCollapsedRange.previousSibling.shadowRoot&&(a.selectNode(g.shadowDomElementAdjacentToCollapsedRange.previousSibling),(K=a.cloneRange()).collapse(!0),l=!0):"move"===c&&(0<o.length&&o[0].shadowRoot?(o[0].parentNode.nodeName.startsWith("GALLERY-")?o[0].previousSibling?a.selectNode(o[0].previousSibling):(a.selectNode(o[0].parentNode),a.collapse(!0)):(a.setStartBefore(o[0]),a.collapse(!0)),l=!0):g.shadowDomElementAdjacentToCollapsedRange&&("after"===g.collapseDirection?(a.selectNode(g.shadowDomElementAdjacentToCollapsedRange),a.collapse(!0),l=!0):g.shadowDomElementAdjacentToCollapsedRange.previousElementSibling&&g.shadowDomElementAdjacentToCollapsedRange.previousElementSibling.shadowRoot&&g.shadowDomElementAdjacentToCollapsedRange.previousSibling==g.shadowDomElementAdjacentToCollapsedRange.previousElementSibling&&(a.selectNode(g.shadowDomElementAdjacentToCollapsedRange.previousElementSibling),a.collapse(!0),l=!0))));break;case"right":"character"===h&&(o=I.helpers.getAllEffectivelyContainedNodes(n),o=[].filter.call(o,function(t){var e=[].find.call(o,function(e){return e!==t&&e.contains(t)});return!e||!e.shadowRoot}),"extend"===c?0<o.length&&o[o.length-1].nextSibling&&o[o.length-1].nextSibling==o[o.length-1].nextElementSibling&&o[o.length-1].shadowRoot&&0<=s?(a.setEndAfter(o[o.length-1].nextSibling),(K=a.cloneRange()).collapse(!1),l=!0):0<o.length&&o[0].nextSibling&&o[0].nextSibling==o[0].nextElementSibling&&o[0].shadowRoot&&-1==s?(a.setStartBefore(o[0].nextSibling),(K=a.cloneRange()).collapse(!0),l=!0):g.shadowDomElementAdjacentToCollapsedRange&&"before"===g.collapseDirection?(a.selectNode(g.shadowDomElementAdjacentToCollapsedRange),(K=a.cloneRange()).collapse(!1),l=!0):g.shadowDomElementAdjacentToCollapsedRange&&"after"===g.collapseDirection&&g.shadowDomElementAdjacentToCollapsedRange.nextSibling&&g.shadowDomElementAdjacentToCollapsedRange.nextSibling.shadowRoot&&(a.selectNode(g.shadowDomElementAdjacentToCollapsedRange.nextSibling),(K=a.cloneRange()).collapse(!1),l=!0):"move"===c&&(0<o.length&&o[o.length-1].shadowRoot?(o[o.length-1].parentNode.nodeName.startsWith("GALLERY-")?o[o.length-1].nextSibling?a.selectNode(o[o.length-1].nextSibling):(a.selectNode(o[o.length-1].parentNode),a.collapse(!1)):(a.setStartAfter(o[o.length-1]),a.collapse(!0)),l=!0):g.shadowDomElementAdjacentToCollapsedRange&&("before"===g.collapseDirection?(a.selectNode(g.shadowDomElementAdjacentToCollapsedRange),a.collapse(!1),l=!0):g.shadowDomElementAdjacentToCollapsedRange.nextElementSibling&&g.shadowDomElementAdjacentToCollapsedRange.nextElementSibling.shadowRoot&&g.shadowDomElementAdjacentToCollapsedRange.nextSibling==g.shadowDomElementAdjacentToCollapsedRange.nextElementSibling&&(a.selectNode(g.shadowDomElementAdjacentToCollapsedRange.nextElementSibling),a.collapse(!1),l=!0))));break;case"up":case"down":"line"===h&&"move"===c&&g.singleSelectedElementWithShadowDom&&g.singleSelectedElementWithShadowDom.parentNode.nodeName.startsWith("GALLERY-")?r=!0:"documentboundary"==h&&("up"===t?(a.setStart(i,0),"extend"==c?a.setEnd(n.endContainer,n.endOffset):a.collapse(!0)):(a.setEnd(i,i.childNodes.length),"extend"==c?a.setStart(n.startContainer,n.startOffset):a.collapse(!1)),l=!0)}if(l)I.helpers.setActiveRange(a),I.helpers.scrollToRange(a,!0);else{var p=window.getSelection(),f=!1;if("extend"===c){K.select(),p.modify("move",d,h);var u=p.getRangeAt(0),u=((K=new I.rangy.createRange).setStart(u.startContainer,u.startOffset),K.setEnd(u.endContainer,u.endOffset),U.comparePoint(K.startContainer,K.startOffset)),a=U.cloneRange();-1==u?(a.setStart(K.startContainer,K.startOffset),a.setEnd(U.startContainer,U.startOffset)):1==u&&(a.setStart(U.startContainer,U.startOffset),a.setEnd(K.startContainer,K.startOffset))}else{n.select();try{p.modify(c,d,h),a=p.getRangeAt(0)}catch(e){f=!0}}if(a&&a.startContainer!==a.endContainer&&(u=W(a.startContainer,function(e){return null!==e.assignedSlot}),p=W(a.endContainer,function(e){return null!==e.assignedSlot}),u||p)&&u!==p&&(u&&u.parentNode&&("move"===c||"extend"===c&&"up"===t)&&a.setStartBefore(u.parentNode),p)&&p.parentNode&&("move"===c||"extend"===c&&"down"===t)&&a.setEndAfter(p.parentNode),"left"===t||"right"===t){if("lineboundary"===h){var m=I.rangy.createRange(),E=(m.setStart(n.startContainer,n.startOffset),m.setEnd(n.startContainer,n.startOffset),m.nativeRange?.getClientRects()?.[0]);if(!E&&g.shadowDomElementAdjacentToCollapsedRange&&(E=g.shadowDomElementAdjacentToCollapsedRange.getBoundingClientRect(),m.selectNode(g.shadowDomElementAdjacentToCollapsedRange)),"left"===t&&E){for(var v=A=m.startContainer.nodeType===Node.TEXT_NODE?m.startContainer:m.startContainer.childNodes[m.startOffset],w={left:E.left,top:E.top,height:E.height};v&&A;){m.selectNode(A);for(var N=!1,C=!1,R=(D=m.nativeRange.getClientRects()).length-1;0<=R;R--){var S=D[R].top+.5*D[R].height,b=E.top+.5*E.height;N=Math.abs(S-b)>.8*E.height&&S<b,C=Math.abs(S-b)>.8*E.height&&b<S,D[R].left<=w.left&&0<D[R].width&&!N&&!C&&(w.left=D[R].left,w.top=D[R].top,w.height=D[R].height,v=A),N&&(A=null)}(A=A?I.helpers.previousNode(A):null)==i&&(A=null)}v.nodeType===Node.ELEMENT_NODE&&(a.setStartBefore(v),"extend"===c?a.setEnd(U.startContainer,U.startOffset):a.setEndBefore(v))}else if("right"===t&&E){for(var A,y=A=m.endContainer.nodeType===Node.TEXT_NODE?m.endContainer:m.endContainer.childNodes[m.endOffset-1],T={right:E.left+E.width,top:E.top,height:E.height};y&&A;){m.selectNode(A);for(var D=m.nativeRange.getClientRects(),N=!1,C=!1,R=0;R<D.length;R++){S=D[R].top+.5*D[R].height,b=E.top+.5*E.height;N=Math.abs(S-b)>.8*E.height&&S<b,C=Math.abs(S-b)>.8*E.height&&b<S,D[R].left+D[R].width>=T.right&&0<D[R].width&&!N&&!C&&(T.right=D[R].left+D[R].width,T.top=D[R].top,T.height=D[R].height,y=A),C&&(A=null)}(A=A?I.helpers.nextNode(A):null)==i&&(A=null)}y.nodeType===Node.ELEMENT_NODE&&("extend"===c?a.setStart(U.startContainer,U.startOffset):a.setStartAfter(y),a.setEndAfter(y))}}}else if(("down"===t||"up"==t)&&(n.equals(a)||r||f)){var x=null;if(g.singleSelectedElementWithShadowDom&&g.singleSelectedElementWithShadowDom.parentNode.nodeName.startsWith("GALLERY-")&&(x=g.singleSelectedElementWithShadowDom.parentNode),!g.singleSelectedElementWithShadowDom&&!g.shadowDomElementAdjacentToCollapsedRange||x){var u=[],u=(u=((a=g.normalizedRange.cloneRange()).nativeRange||a).getClientRects(),(p=!("move"===c&&"forward"===d||"extend"===c&&1==s)&&("move"===c&&"backward"===d||"extend"===c&&-1==s)?u[0]:u[u.length-1])&&(0!==p.top||0!==p.left)||a.startContainer.nodeType!==Node.ELEMENT_NODE||((f=document.createElement("span")).innerHTML="@",f.style.width="0px",f.style.opacity=0,f.setSaveable(!1),a.collapse(!0),a.startContainer?(a.startContainer.insertBefore(f,a.startContainer.childNodes[a.startOffset]),p=f.getBoundingClientRect(),f.remove()):p={left:0,width:0,top:0,height:0}),"up"===t?p.left+1:p.left+p.width+-1),O="up"===t?p.top+.5*-p.height:p.top+1.5*p.height,L=function(e,t){e=document.elementFromPoint(e,t);return e&&x!==e&&i.contains(e)&&e.shadowRoot?e:null},_=L(u,O);if(!_){var k=.5*p.height,j={left:0,width:document.documentElement.clientWidth},B=(x&&(j.left=p.left,j.width=p.width,k=40),j.width/15);if("up"===t)for(var M=0;M<4;M++){for(R=0;R<15&&!(_=L(R*B+j.left,O));R++);if(_)break;O-=k}else for(M=0;M<4;M++){for(R=0;R<15&&!(_=L(R*B+j.left,O));R++);if(O+=k,_)break}}}else{f=(g.singleSelectedElementWithShadowDom||g.shadowDomElementAdjacentToCollapsedRange).getBoundingClientRect();a="up"===t?I.helpers.createRangeAtCoordinates(f.x+2,f.y-8):I.helpers.createRangeAtCoordinates(f.x+f.width+-2,f.y+f.height+8)}(_=x&&!_?x:_)?"MEDIA-ITEM"===_.nodeName&&_.parentNode.nodeName.startsWith("GALLERY-")?a.selectNode(_):"up"===t?"extend"===c?a.setStartBefore(_):(a.setStartBefore(_),a.collapse(!0)):"extend"===c?a.setEndAfter(_):(a.setStartAfter(_),a.collapse(!0)):"up"===t?"extend"===c?a.setStart(i,0):(a.setStart(i,0),a.collapse(!0)):"extend"===c?a.setEnd(i,i.childNodes.length):(a.setStart(i,i.childNodes.length),a.collapse(!0))}u=!1,u=!("move"===c&&"forward"===d||"extend"===c&&1==s)&&("move"===c&&"backward"===d||"extend"===c&&-1==s);I.helpers.scrollToRange(a,u),I.helpers.setActiveRange(a)}I.events.trigger("cursor-activity",I.getActiveEditor())}}function i(e){N();var t,n,o=I.getActiveRange();o?(n=o.startContainer).nodeType!=Node.DOCUMENT_NODE&&(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement),(t=o.endContainer).nodeType===Node.TEXT_NODE&&(t=t.parentElement),n)&&t&&(n=n.closest("[slot]"),t=t.closest("[slot]"),v=n||t||null,n||t)&&(t!==n||n&&!n.contains(o.commonAncestorContainer))&&l((n=n||t).parentNode)&&(o.selectNodeContents(n),I.helpers.setActiveRange(o)):v=null}var g,p,W=function(e,t){e=e&&(t(e)?e:W(e.parentNode,t));return e||null},l=function(e){e.nodeType,Node.ELEMENT_NODE,e.shadowRoot,e.nodeName.startsWith("GALLERY-")||e.nodeName.startsWith("COLUMN-")||e.nodeName.startsWith("MARQUEE-");return-1<["AUDIO-PLAYER","MEDIA-ITEM","SHOP-PRODUCT"].indexOf(e.nodeName)},r=new CustomEvent("unselected-in-editor",{bubbles:!1,composed:!0}),s=new CustomEvent("selected-in-editor",{bubbles:!1,composed:!0,detail:{collapsed:!1}}),d=[],c=document.contains(document.activeElement),h=e=>{c=!1},f=e=>{c=!0},u=document.createElement("textarea"),m=(u.setAttribute("tabIndex","-1"),u.classList.add("selection-trap"),u.style.position="fixed",u.style.top="-100px",u.style.left="=100px",u.style.zIndex=9999,u.value=" ",u.style.width="100px",u.addEventListener("change",e),u.addEventListener("keydown",e),u.addEventListener("copy",e),u.addEventListener("cut",e),window.addEventListener("keydown",e),window.addEventListener("copy",e),window.addEventListener("paste",e),window.addEventListener("cut",e),function(e){0}),U=null,K=null,E=this,v=null,w=!1,N=function(){w||(w=!0,requestAnimationFrame(function(){var e=I.getActiveRange();if(void 0===e)[].forEach.call(d,function(e){e.dispatchEvent(r)}),d.length=0;else{var t=I.helpers.normalizeRangeAroundShadowDom(e),n=[].map.call(d,function(e){return e}),e=I.helpers.getAllEffectivelyContainedNodes(e),o=(d.length=0,e.forEach(e=>{e.__shadow_selection&&-1==d.indexOf(e)&&d.push(e)}),[].forEach.call(n,function(e){-1==d.indexOf(e)&&e.dispatchEvent(r)}),s.detail.collapsed=!1),o=!!t.shadowDomElementAdjacentToCollapsedRange&&(s.detail.collapsed=t.collapseDirection,t.shadowDomElementAdjacentToCollapsedRange.dispatchEvent(s),!0),e=(s.detail.collapsed=!1,[].forEach.call(d,function(e){o=!0,e.dispatchEvent(s)}),t.shadowDomElementAdjacentToCollapsedRange&&d.push(t.shadowDomElementAdjacentToCollapsedRange),I.getActiveEditor()),n,t=0<(n=window.getSelection())?.rangeCount?n.getRangeAt(0):null;if(e)if(o||(!t&&I.forcedRange||t&&!e.getElement().contains(t.commonAncestorContainer))&&(o=!0),o){document.removeEventListener("selectionchange",N);var a=I.getActiveEditor().getElement(),i=(a.style.caretColor="transparent",document.contains(u)||document.body.append(u),document.querySelector(".overlay")),l=!0;const e=I.getActiveRange();t&&i&&i.contains(t.commonAncestorContainer)&&(l=!1),c&&l&&(0==n.rangeCount||e.collapsed?(u.select(),u.setSelectionRange(0,0)):(!t.collapsed||e.collapsed)&&a.contains(e?.commonAncestorContainer)||(u.select(),u.setSelectionRange(0,1))),setTimeout(function(){document.addEventListener("selectionchange",N)},1)}else I.getActiveEditor().getElement().style.caretColor=""}w=!1}))};function C(){p=I.getActiveRange()}function R(){I.forcedRange&&!I.forcedRange.isValid()&&(I.forcedRange=null),N()}function S(t){var e;void 0!==t&&(I.forcedRange&&!I.forcedRange.isValid()&&(I.forcedRange=null),e=t.generateUnreportedMutationSummaries(),[].forEach.call(e,function(e){T(e,t)}))}function b(e,t){I.forcedRange&&!I.forcedRange.isValid()&&(I.forcedRange=null),g=t}function A(){document.body.contains(u)&&u.remove(),I.forcedRange=null}var y=!1,T=(E.preventSlottedElementCorrectionOnce=!1,function(e,t){I.getActiveRange();t=t.getElement();if(!E.preventSlottedElementCorrectionOnce&&p&&!t.contains(p.commonAncestorContainer)&&("delete"===g||"forwarddelete"===g||v)){var n,o,a=[],i=[],l=0;for(y=!1,a=(a=a.concat(e.removed)).concat(e.reparented),l=0;l<a.length;l++)(r=a[l]).nodeType===Node.ELEMENT_NODE&&r.shadowRoot?(r.innerHTML="",i.push(r)):v==r&&(n=e.getOldParentNode(r))&&n.shadowRoot&&(y=!0,i.push(r));for(l=0;l<i.length;l++){for(var r=i[l],s=e.getOldPreviousSibling(r),d=i.indexOf(s);l<d;)s=e.getOldPreviousSibling(r=i[d]),i[d]=i[l],i[l]=r,d=i.indexOf(s);var c=e.getOldParentNode(r),h=s?s.nextSibling:c.firstChild;c.ownerDocument.contains(c)?h&&h.parentNode!==c?console.log("Unable to insert",r,"after",h,". The reference node is not contained by the old parent",c):c.insertBefore(r,h):console.log("Unable to restore",r,"into",c,"as the old parent node is not contained by the DOM anymore")}y&&v&&(o=v,[].forEach.call(e.characterDataChanged,function(e){o.appendChild(e)}),I.events.once("mutation-end",function(){setTimeout(function(){var e=I.rangy.createRange();e.selectNodeContents(o),e.collapse(!1),I.helpers.setActiveRange(e),I.events.trigger("cursor-activity",I.getActiveEditor())},0)}))}E.preventSlottedElementCorrectionOnce=!1});window.addEventListener("focus",f),window.addEventListener("blur",h),document.addEventListener("selectionchange",N),this.events.on("mutation-end",R),this.events.on("editor-mousedown",n),this.events.on("cursor-activity",i),this.events.on("editor-keydown",a),this.events.on("editor-keydown",o),this.events.on("mutation-before-success",S),this.events.on("exec-command",b),this.events.on("mutation-start",C),this.events.on("editor-dragstart",t),this.events.on("editor-destroyed",A),this.canBeEntirelySelected=l,this.shadowDomSelectedElements=d,this.destroy=function(){this.events.off("editor-destroyed",A),this.events.off("exec-command",b),this.events.off("mutation-start",C),this.events.off("editor-dragstart",t),window.removeEventListener("blur",h),window.removeEventListener("focus",f),document.removeEventListener("selectionchange",N),this.events.off("mutation-before-success",S),this.events.off("mutation-end",R),this.events.off("editor-mousedown",n),this.events.off("editor-keydown",a),this.events.off("editor-keydown",o),this.events.off("cursor-activity",i)}}),CargoEditor.addPlugin("wrapTextNodes",function(l){"use strict";function t(e,t){return e&&1==e.nodeType&&function(e,t){var n,o;for(t=t.toUpperCase(),n=0,o=e.length;n<o;n++)if(e[n].toUpperCase()===t)return!0;return!1}(t,e.nodeName)}function r(e){return t(e,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"])||t(e,["li","dt","dd"])}this.wrapTextNodes=function(e){if(!e||void 0===e.getElement)return console.error("no editor given"),!1;var t,n,e=e.getElement(),o=[];for([].forEach.call(e.childNodes,function(e){l.helpers.recursivelyFindDeepestWrappableNodesInBlockContainer(e).forEach(function(e){-1!==o.indexOf(e)&&o.splice(o.indexOf(e),1),o.push(e)})});o.length;){var a,i=[];for(i.push(o.shift());o.length&&o[0]==i[i.length-1].nextSibling&&!r(o[0])&&(n="BR",!(t=i[i.length-1])||1!=t.nodeType||n.toUpperCase()!==t.nodeName);)i.push(o.shift());0<i.length&&(null!==i[0].previousSibling&&"TEXT-WRAPPER"===i[0].previousSibling.nodeName?a=i[0].previousSibling:(a=document.createElement("text-wrapper"),i[0].parentNode.insertBefore(a,i[0])),i.forEach(function(e){a.appendChild(e)}))}},this.correctWrappedTextNodes=function(e,t){if(!e||void 0===e.getElement)return console.error("no editor given"),!1;e=e.getElement();[].forEach.call(e.querySelectorAll("text-wrapper"),function(e){if(null!==e.previousSibling&&"TEXT-WRAPPER"===e.previousSibling.nodeName){for(;0<e.childNodes.length;)e.previousSibling.appendChild(e.childNodes[0]);e.parentNode.removeChild(e)}})},this.events.on("editor-summary-created",_.bind(this.correctWrappedTextNodes,this))});